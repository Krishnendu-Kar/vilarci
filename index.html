<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <!-- SEO Meta -->
        <meta name="description" content="vilarci - Fast, reliable, and secure e-commerce shopping. Get trusted products with quick delivery and excellent customer support.">
        <meta name="keywords" content="vilarci, online shopping, fast delivery, secure e-commerce, reliable service">
        <meta name="author" content="Krishnendu Kar">
        <meta name="robots" content="index, follow">

        <!-- Open Graph (Facebook, LinkedIn, WhatsApp) -->
        <meta property="og:title" content="vilarci - Our Official e-commerce Website">
        <meta property="og:description" content="Shop faster and safer with vilarci – your trusted e-commerce platform for quick delivery, secure shopping, and reliable service.">
        <meta property="og:image" content="https://krishnendu-kar.github.io/vilarci/logo.png">
        <meta property="og:url" content="https://krishnendu-kar.github.io/vilarci/">
        <meta property="og:type" content="website">

        <!-- Twitter Card -->
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:title" content="vilarci - Our Official e-commerce Website">
        <meta name="twitter:description" content="Shop faster and safer with vilarci – your trusted e-commerce platform for quick delivery, secure shopping, and reliable service.">
        <meta name="twitter:image" content="https://krishnendu-kar.github.io/vilarci/logo.png">

        <!-- Preloads -->
        <link rel="preload" href="style.css" as="style">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" xintegrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

        <!-- Canonical -->
        <link rel="canonical" href="https://krishnendu-kar.github.io/vilarci/">

        <!-- Favicon & Apple Icon -->
        <link rel="shortcut icon" href="logo.ico" type="image/x-icon">
        <link rel="icon" href="logo.ico" type="image/x-icon">
        <link rel="apple-touch-icon" href="logo.ico" sizes="180x180">

        <!-- Styles -->
        <link rel="stylesheet" href="style.css">

        <!-- Title -->
        <title>Vilarci - Fast & Reliable E-commerce Shopping</title>
        
        <!-- Added for Toast Notifications -->
        <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
        <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    </head>
    <body>
            <div class="loader-container" id="page-loader">
                <div class="loaderout">
                    <div class="loaderin1">
                        <div class="loaderin2">
                            <div class="loaderin3"></div>
                        </div>
                    </div>
                </div>
                <p class="loader-p" id="loader-text">Please wait...</p>
            </div>
        <header>
            <div class="navbar">
                <div class="nav-logo border" onclick="window.location.href='index.html'">
                    <div class="logo-name">Vilarci</div>
                    <div><img class="logo" src="logo.png" alt="logo" loading="lazy"> </div>
                </div>
                <div class="nav-address border">
                    <p class="location">location</p>
                    <div class="address-icon">
                        <p class="location-name"><i class="fa-solid fa-location-dot"></i>
                        radhaballavpur</p>
                    </div>
                </div>
                <div>
                    <a class="border" href="OrderTracking.html"><abbr class="order" title="Track your order">Orders</abbr> </a>
                </div>
                <div class="seller border">
                    <a href="seller home.html" target="_blank" class="feedback-btn">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="15" viewBox="0 0 16 15">
                            <defs>
                                <linearGradient id="a" x1="0%" x2="86.876%" y1="0%" y2="80.202%">
                                <stop offset="0%" stop-color="#FFF6CC"/>
                                <stop offset="100%" stop-color="#FFD580"/>
                                </linearGradient>
                            </defs>
                            <g fill="none" fill-rule="evenodd">
                                <path d="M-2-2h20v20H-2z"/>
                                <path fill="url(#a)" fill-rule="nonzero" d="M15.93 5.614h-2.948V4.14c0-.818-.655-1.473-1.473-1.473H8.56c-.817 0-1.473.655-1.473 1.473v1.474H4.14c-.818 0-1.466.656-1.466 1.474l-.001 8.105c0 .818.655 1.474 1.473 1.474h11.79c.818 0 1.474-.656 1.474-1.474V7.088c0-.818-.656-1.474-1.474-1.474zm-4.421 0H8.56V4.14h2.949v1.474z" transform="translate(-2 -2)"/>
                            </g>
                        </svg>
                        Become a seller
                    </a>
                </div>
                <div class="feedback border">
                    <a href="https://forms.gle/o6QnsSHPTd5EUZ2q6" class="feedback-btn">
                     Feedback </a>
                </div>
                   
            </div>
            <div class="panel">
                <!-- Hamburger Button -->
                 <div id="global-sidebar-container"></div>
                <script src="sidebar.js"></script>
                    <!-- Search Bar -->
                <div class="nav-search search-wrapper border">
                    <input type="search" class="search-input search-boxAni" id="productSearch" onclick="window.location.href='universal search.html'" placeholder=" ">
                    <div class="search-icon" onclick="window.location.href='universal search.html'"><p><i class="fa-solid fa-magnifying-glass" style="color: #d70675;"></i></p></div>
                </div>
                <ul>
                    <li><a class="panel-a1 border" href="lucky winners.html">lucky winners</a></li>
                    <li><a class="panel-a2 border" href="tutorial video.html">Need help?</a></li>
                    <li><a class="panel-a3 border" href="about_us.html">About Us</a></li>
                </ul>
            </div>
            <div class="cart border" onclick="window.location.href='cart.html'">
                    <!-- Updated ID to match script logic -->
                    <p class="cart-amount" id="cart-count-badge">0</p>
                    <div class="cart-icon">
                        <p><i class="fa-solid fa-cart-arrow-down"></i>
                        </p>
                    </div>
                </div>
            <div class="message-box1 border">
                <div class="message-box2">
                    <div class="message-text">
                       Order Now & Save Big! Lightning-fast delivery at incredible prices – because you are special for us
                    </div>
                </div>
            </div>
        </header>
        <main>
            
               <div class="category-scroll-container">
                    <div class="cat-item" onclick="window.location.href='comboCategory.html'">
                        <i class="bi bi-collection-fill"></i>
                        <p>Combo Packs</p>
                    </div>

                    <div class="cat-item" onclick="window.location.href='bestdealCategory.html'">
                        <i class="bi bi-lightning-charge-fill"></i>
                        <p>Best Deal</p>
                    </div>

                    <div class="cat-item" onclick="window.location.href='groceryCategory.html'">
                        <i class="bi bi-basket2-fill"></i>
                        <p>Staples</p>
                    </div>

                    <div class="cat-item" onclick="window.location.href='colddrinkCategory.html'">
                        <i class="bi bi-cup-straw"></i>
                        <p>Cold Drinks</p>
                    </div>

                    <div class="cat-item" onclick="window.location.href='snacksCategory.html'">
                        <i class="bi bi-bag-heart-fill"></i>
                        <p>Snacks</p>
                    </div>

                    <div class="cat-item" onclick="window.location.href='biscuitCategory.html'">
                        <i class="bi bi-circle-fill"></i>
                        <p>Biscuits</p>
                    </div>
                    <div class="cat-item" onclick="window.location.href='oilCategory.html'">
                        <i class="bi bi-droplet-fill"></i> <p>Oil</p>
                    </div>

                    <div class="cat-item" onclick="window.location.href='dailyProductCategory.html'">
                        <i class="bi bi-house-heart-fill"></i> <p>Daily Needs</p>
                    </div>
                </div>
            </div>
            <div class="sub-header">
                <div class="slider-container">
                    <div class="slider-wrapper">
                        <div class="slide">
                            <picture>
                                <source media="(min-width: 911px)" srcset="soap_slider_pc.png">
                                <img src="soap slider.png" alt="Description for banner 1" loading="eager">
                            </picture>
                        </div>
                        <div class="slide">
                            <picture>
                                <source media="(min-width: 469px)" srcset="YOUR_DESKTOP_IMAGE_2.jpg">
                                <img src="snacks.png" alt="Description for banner 2" loading="lazy">
                            </picture>
                        </div>
                        <div class="slide">
                            <picture>
                                <source media="(min-width: 469px)" srcset="YOUR_DESKTOP_IMAGE_3.jpg">
                                <img src="cold drink.png" alt="Description for banner 3">
                            </picture>
                        </div>
                        <div class="slide">
                            <picture>
                                <source media="(min-width: 469px)" srcset="YOUR_DESKTOP_IMAGE_4.jpg">
                                <img src="staples.png" alt="Description for banner 4">
                            </picture>
                        </div>
                    </div>
                    <button class="slider-btn prev"><i class="fa-solid fa-chevron-left"></i></button>
                    <button class="slider-btn next"><i class="fa-solid fa-chevron-right"></i></button>
                    <div class="slider-dots"></div>
                </div>

                </div>
                <div id="flash-sale-section" class="flash-section-hidden">
                    <div class="flash-header">
                        <div class="flash-title">
                            <i class="fa-solid fa-bolt-lightning"></i> DEAL OF THE HOUR
                            <span id="flash-status-text">Ends in:</span>
                        </div>
                        <div class="flash-timer" id="flash-timer-display">00:00:00</div>
                    </div>

                    <div class="flash-scroll-container" id="flash-products-container">
                        </div>
                </div>
            </div>

            <div id="addCartMessage" class="cartMessage"></div>
            
            <button id="backToTop" onclick="scrollToTop()">
                <i class="fa-solid fa-arrow-up"></i>
            </button>
            
            <div class="shop-section" id="productList">
                
            </div>
        </main>
        <footer>
            ©2025 vilarci ; All Right will be reserved
        </footer>
        
        <script>
           // 1. Select the element and store it in a constant
            const locationElement = document.querySelector('.location-name');

            // 2. Get the text content and remove extra whitespace (newlines)
            if(locationElement) {
                let text = locationElement.textContent.trim(); 
                // 3. Check length and truncate if necessary
                const truncatedText = text.length > 7 ? text.substring(0, 7) + "..." : text;
                // 4. Update the HTML
                locationElement.innerHTML = `<i class="fa-solid fa-location-dot"></i> ${truncatedText}`;
            }
        </script>

    <!-- 1. SUPABASE & CONFIG -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
const SUPABASE_URL = 'https://gxvcgubbqtccoycvdupq.supabase.co';
    const SUPABASE_KEY = 'sb_publishable_wy4_pxxwFkS63SSL_d5yug_Bgybs85R';
    
    // CHANGED: Renamed variable to 'supabaseClient' to fix the conflict
    const supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
    
    let packetProducts = [];
        // 2. FETCH FROM DB
// 2. FETCH FROM DB
    async function fetchAndDisplayProducts() {
        const loader = document.getElementById('page-loader');
        if(loader) loader.style.display = 'flex';

        try {
            // CHANGED: Using 'supabaseClient' here
            const { data, error } = await supabaseClient
                .from('products')
                .select('*')
                .eq('is_active', true)
                .order('created_at', { ascending: false })
                .limit(50);

            if (error) {
                console.error("Error fetching products:", error);
                // Don't return yet, let the 'finally' block hide the loader
            } else if (data) {
                // 3. MAP DB TO FRONTEND
                packetProducts = data.map(p => ({
                    id: p.id,
                    slug: p.slug, 
                    name: p.name,
                    price: p.base_price,
                    originalPrice: p.original_price,
                    rating_avg : p.rating_avg,
                    rating_count: p.rating_count,
                    image: (p.images && p.images.length > 0) ? p.images[0] : 'https://via.placeholder.com/200?text=Vilarci',
                    category: p.category_id,
                    rating: 4.5,
                    amount: p.amount
                }));

                // 4. RENDER
                displayProducts(packetProducts, 'productList');
            }
        } catch (err) {
            console.error("Unexpected error:", err);
            document.getElementById('productList').innerHTML = '<p style="text-align:center; padding: 20px;">Unable to load products. Please check your connection.</p>';
        } finally {
            // CRITICAL FIX: This runs 100% of the time, guaranteeing the loader disappears
            if(loader) {
                loader.style.opacity = "0"; 
                setTimeout(() => {
                    loader.style.display = "none";
                }, 500); 
            }
            updateCartCount();
        }
    }

        // 5. RENDER FUNCTION
        function displayProducts(products, containerId) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';

            if (products.length === 0) {
                container.innerHTML = '<p class="text-center w-full p-10 text-gray-500">No products found.</p>';
                return;
            }

            products.forEach(product => {
                let discountBadge = '';
                if (product.originalPrice > product.price) {
                    const off = Math.round(((product.originalPrice - product.price) / product.originalPrice) * 100);
                    discountBadge = `<div class="discount-percent">${off}% OFF</div>`;
                }

                const card = `
                    <div class="product-card" onclick="window.location.href='product_details.html?slug=${product.slug}'">
                        ${discountBadge}
                        <div class="img-box">
                            <img src="${product.image}" alt="${product.name}" loading="lazy">
                        </div>
                        <div class="details">
                            <h4 class="product-name">${product.name}</h4>
                            <p><span class="rating_avg">${product.rating_avg} <i style="font-size:0.6em; position: relative;top: -2px;" class="fa-solid fa-star"></i></span> <span class="rating_count"> ${product.rating_count} Ratings</span> </p>
                            <div class="price-area">
                                <span class="price">₹${product.price}</span>
                                ${product.originalPrice ? `<span class="mrp">₹${product.originalPrice}</span>` : ''}
                            </div>
                            <button class="add-btn" onclick="addToCart(event, '${product.id}')">
                                Add <i class="fa-solid fa-cart-plus"></i>
                            </button>
                        </div>
                    </div>
                `;
                container.innerHTML += card;
            });
        }

        // 6. CART LOGIC
        // 6. CART LOGIC (UPDATED FOR FASHION)
        function addToCart(event, id) {
            
            event.stopPropagation(); // Prevent the card click event
            
            // 1. Find product in our local array
            const product = packetProducts.find(p => String(p.id) === String(id));
            
            if (!product) return;

            // 2. CHECK FOR FASHION PRODUCT (Code 12)
            // We assume the ID is a string. If it's a number, String() converts it.
            const idString = String(product.id);
            const fashionCode = idString.substring(6, 8); // Check indices 6 and 7

            if (fashionCode === '12') {
                // IT IS FASHION: Redirect to details page to pick a size
                Toastify({
                    text: "Please select a size first",
                    duration: 3000,
                    gravity: "top", 
                    position: "center", 
                    style: {
                        background: "#3b82f6", // Blue for info
                        borderRadius: "8px",
                        fontSize: "14px"
                    }
                }).showToast();
                
                // Small delay to let them read the toast, then redirect
                setTimeout(() => {
                    window.location.href = `product_details.html?slug=${product.slug}`;
                }, 1000);
                
                return; // STOP HERE
            }

            // 3. STANDARD PRODUCT LOGIC (Packets/Weights)
            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            
            const existingItem = cart.find(item => String(item.id) === String(id));

            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({
                    ...product,
                    quantity: 1
                });
            }

            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartCount();
            
            // Success Notification
            Toastify({
                text: `${item.name}Added to Cart!`,
                duration: 3000,
                gravity: "top", 
                position: "center", 
                style: {
                    background: "#22c55e", // Green for success
                    borderRadius: "8px",
                    fontSize: "14px"
                }
            }).showToast();
        }

        function updateCartCount() {
            let cart = JSON.parse(localStorage.getItem('cart')) || [];
            let count = cart.reduce((acc, item) => acc + item.quantity, 0);
            const badge = document.getElementById('cart-count-badge');
            if(badge) badge.innerText = count;
            
            // Update class amount if used elsewhere
            const badges = document.querySelectorAll('.cart-amount');
            badges.forEach(b => b.innerText = count);
        }

        // Init Supabase Load
        document.addEventListener("DOMContentLoaded", fetchAndDisplayProducts);
    </script>

    <!-- Other scripts (Slider, Animation) -->
    <script>
        // --- Loader Text Animation ---
        const messages = [
            "Fetching the best deals for you...",
            "Getting the latest products...",
            "Almost there, don’t go anywhere...",
            "Loading happiness to your doorstep..."
        ];

        let i = 0;
        const loaderText = document.getElementById("loader-text");

        if(loaderText) {
            setInterval(() => {
                loaderText.textContent = messages[i];
                i = (i + 1) % messages.length;
            }, 2000);
        }

        // --- Search Bar Typing Animation ---
        const searchInputBox = document.querySelector(".search-boxAni");

        const fullTexts = [
        " Search products...",
        " Search categories...",
        " Search offers..."
        ];

        const shortTexts = [
        " Products...",
        " Categories...",
        " Offers..."
        ];

        let texts = []; 
        let textIndex = 0;
        let charIndex = 0;
        let currentText = "";
        let typing = true;

        function updateTexts() {
            if (window.matchMedia("(max-width: 475px)").matches) {
                texts = shortTexts;
            } else {
                texts = fullTexts;
            }
        }

        function typeAnimation() {
            if (!searchInputBox) return;
            
            if (typing) {
                currentText = texts[textIndex].slice(0, ++charIndex);
                searchInputBox.setAttribute("placeholder", currentText);

                if (charIndex === texts[textIndex].length) {
                typing = false;
                setTimeout(typeAnimation, 1500); 
                return;
                }
            } else {
                currentText = texts[textIndex].slice(0, --charIndex);
                searchInputBox.setAttribute("placeholder", currentText);

                if (charIndex === 0) {
                typing = true;
                textIndex = (textIndex + 1) % texts.length;
                }
            }
            setTimeout(typeAnimation, typing ? 70 : 60);
        }

        updateTexts();
        window.addEventListener("resize", updateTexts);
        typeAnimation();

        // --- Slider Functionality ---
        document.addEventListener('DOMContentLoaded', function () {
            const sliderWrapper = document.querySelector('.slider-wrapper');
            if (!sliderWrapper) return;

            const slides = document.querySelectorAll('.slide');
            const prevBtn = document.querySelector('.slider-btn.prev');
            const nextBtn = document.querySelector('.slider-btn.next');
            const dotsContainer = document.querySelector('.slider-dots');
            
            let currentIndex = 0;
            let slideInterval;
            const totalSlides = slides.length;

            for (let i = 0; i < totalSlides; i++) {
                const dot = document.createElement('div');
                dot.classList.add('dot');
                dot.addEventListener('mouseover', () => {
                    goToSlide(i);
                    resetInterval();
                });
                dotsContainer.appendChild(dot);
            }
            const dots = document.querySelectorAll('.dot');

            function goToSlide(index) {
                sliderWrapper.style.transform = `translateX(-${index * 100}%)`;
                dots.forEach(dot => dot.classList.remove('active'));
                if(dots[index]) dots[index].classList.add('active');
                currentIndex = index;
            }

            if(nextBtn) {
                nextBtn.addEventListener('click', () => {
                    const nextIndex = (currentIndex + 1) % totalSlides;
                    goToSlide(nextIndex);
                    resetInterval();
                });
            }

            if(prevBtn) {
                prevBtn.addEventListener('click', () => {
                    const prevIndex = (currentIndex - 1 + totalSlides) % totalSlides;
                    goToSlide(prevIndex);
                    resetInterval();
                });
            }

            function startInterval() {
                slideInterval = setInterval(() => {
                    const nextIndex = (currentIndex + 1) % totalSlides;
                    goToSlide(nextIndex);
                }, 5000); 
            }

            function resetInterval() {
                clearInterval(slideInterval);
                startInterval();
            }

            goToSlide(0);
            startInterval();
        });
        
        window.onscroll = function() {scrollFunction()};

        function scrollFunction() {
            const btn = document.getElementById("backToTop");
            if (!btn) return; 
            if (document.body.scrollTop > 400 || document.documentElement.scrollTop > 400) {
                btn.style.display = "block";
            } else {
                btn.style.display = "none";
            }
        }

        function scrollToTop() {
            window.scrollTo({top: 0, behavior: 'smooth'});
        }
    </script>

    <style>
        .shop-section {
            display: grid;
            gap: 15px;
            padding: 15px;
        }
        .product-card {
            background: white;
            border: 1px solid #eee;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
            cursor: pointer;
            transition: transform 0.2s;
        }
        @media (max-width: 364px){
            .product-card {
                width: 45vw;
            }
        }
        @media (min-width: 365px){
            .shop-section {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
        }}
        .product-card:hover {  box-shadow: 0 5px 15px rgba(0,0,0,0.3); }

        .img-box { height: 160px; padding: 10px; display: flex; justify-content: center; align-items: center; }
        .img-box img { max-height: 100%; max-width: 100%; }
        .details { padding: 10px;}
        .product-name { font-size: 13px; margin: 0 0 5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .price-area { display: flex; align-items: baseline; gap: 5px;margin-top:2px; margin-bottom: 8px; }
        .price { font-weight: bold; font-size: 15px; }
        .mrp { text-decoration: line-through; font-size: 11px; color: #999; }

    </style>
    </body>
</html>